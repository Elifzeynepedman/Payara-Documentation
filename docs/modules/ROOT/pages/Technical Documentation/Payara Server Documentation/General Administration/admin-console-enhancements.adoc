[[admin-console-enhancements]]
= Admin Console Enhancements

[[asadmin-recorder]]
== Asadmin Recorder

This feature allows you to record the actions you take in the admin console as asadmin commands, aiding with automating or reproducing your setup across multiple Payara Server installations.

[[starting-and-stopping-the-asadmin-recorder]]
== Starting and Stopping the Asadmin Recorder

From the admin console, you should be able to see a button labelled _Enable Asadmin Recorder_ or _Disable Asadmin Recorder_, depending on whether or not the asadmin recorder feature is enabled or not. Clicking this button will enable or disable the asadmin recorder feature respectively:

image:recorder/enable-recorder.png[Enable recorder in Web Console]

image:recorder/disable-recorder.png[Disable recorder in Web Console]

Once enabled, actions in the admin console that have a corresponding `asadmin` command will be recorded to a file. By default, this file is located in the domain directory, and is called _asadmin-commands.txt_.

Once enabled or disabled, the asadmin recorder will remain enabled/disabled until specifically enabled or disabled again through the web console or using the appropriate asadmin command. This means that the asadmin recorder will remain enabled or disabled across server restarts.

You can also enable or disable the asadmin recorder on its configuration page (detailed in the following section), or by using the following asadmin commands:

`enable-asadmin-recorder`:: Enables the asadmin recorder.
`disable-asadmin-recorder`:: Disables the asadmin recorder.
`set-asadmin-recorder-configuration --enabled true`:: Alternative way of enabling the asadmin recorder.
`set-asadmin-recorder-configuration --enabled false`:: Alternative way of disabling the asadmin recorder.

[[configuring-the-asadmin-recorder]]
== Configuring the Asadmin Recorder

To configure the asadmin recorder, navigate to the following page in the admin console: _server -> Asadmin Recorder_:

image:recorder/recorder-config.png[Asadmin recorder configuration]

You will be presented with the following configuration options:

_Enabled_:: Sets whether the asadmin recorder service should be enabled or disabled.
_Filter Commands_:: Sets whether or not to exclude the `asadmin` commands and regular expressions listed in the _Filtered Commands_ setting from being recorded.
_Output Location_:: The absolute file path for the `asadmin` commands to be written to. This defaults to a file called _asadmin-commands.txt_ in the domain directory.
_Filtered Commands_:: A comma separated list of asadmin commands and regular expressions to be excluded from being recorded if the _Filter Commands_ option is enabled.

The default regular expressions and asadmin commands set in the _Filtered Commands_ option are a selection of commands and regular expressions that are typically not needed for any automation purposes, yet are still sometimes called by commands and through navigation of the admin console. If you remove any of these commands from the filtered commands list, or choose not to filter any commands at all, the asadmin commands script is liable to get filled up with these commands. Due to this behavior, it is advised that you only add to this list, only removing the defaults if you really need to.

Be sure to click on the _Save_ button to have any changes you make take effect.

In addition to using the admin console, you can configure the asadmin recorder service using the `set-asadmin-recorder-configuration` command. The command takes the following parameters:

`--enabled`:: Enables or Disables the Asadmin Recorder service.
`--outputLocation`:: Specifies the absolute file path of where the recorded asadmin commands will be written to.
`--filterCommands`:: Specifies whether or not the commands specified with the `--filteredcommands` option should be excluded from being recorded or not.
`--filteredCommands`:: A comma separated list of asadmin commands and regular expressions to exclude from being recorded.

As an example, the following will enable the asadmin recorder, set the output location to _/home/user/asadmin-commands.txt_, and prevent the `start-instance` command from being recorded (in addition to the default configuration):

[source, shell]
----
asadmin set-asadmin-recorder-configuration --enabled true --outputLocation /home/user/asadmin-commands.txt --filterCommands true --filteredCommands "version,_(.*),list(.*),get(.*),uptime,enable-asadmin-recorder,disable-asadmin-recorder,set-asadmin-recorder-configuration,asadmin-recorder-enabled,start-instance"
----

[[running-the-generated-scripts]]
== Running the Generated Scripts

Documentation on running asadmin scripts can be found in the _GlassFish Server Administration Guide_, under the _Run a Set of  asadmin Subcommands From a File_ section. The guide can be found in  the _GlassFish Server {glassfishVersion} Open Source Edition Documentation_ referenced in the xref:/Technical Documentation/Payara Server Documentation/Overview.adoc[Payara Server Documentation Overview]

[[asadmin-commands]]
== Asadmin Commands
The following is the list of available asadmin commands with their available options to configure the asadmin recorder:

[cols=",,a",options="header",]
|=======================================================================
|Command |Description |Options
|`get-asadmin-recorder-configuration` |Returns the current configuration of the Asadmin Recorder service.
|None
|`set-asadmin-recorder-configuration` |Configures the Asadmin Recorder service. |
* `--enabled` - Enables or Disables the Asadmin Recorder service.
* `--outputLocation` - Specifies the absolute file path of where the recorded asadmin commands will be written to.
* `--filterCommands` - Specifies whether or not the commands specified with the `--filteredcommands` option should be excluded from being recorded or not.
* `--filteredCommands` - A comma separated list of asadmin commands and regular expressions to exclude from being recorded.
|`enable-asadmin-recorder` |Enables the Asadmin Recorder service with its current configuration settings.
|None
|`disable-asadmin-recorder` |Disables the Asadmin Recorder service.
|None
|`asadmin-recorder-enabled` |Returns whether or not the Asadmin Recorder service is enabled.
|None
|=======================================================================

[[admin-console-auditing-service]]
== Admin Console Auditing Service

This feature allows users to log all actions and operations executed via the admin console for auditing purposes.

[[configuring-the-auditing-service]]
== Configuring the Auditing Service

All operations executed by users with access to the admin console will be translated to events that correspond to the specific admin user that executed the operation and the `asadmin` command (and its parameters) that is equivalent to the operation being executed in the admin console. For example if the default `admin` user modifies the monitoring level of the _Web Services Container_, the following event will be generated:

----
AUDIT - admin issued command set with parameters
{
    DEFAULT: [configs.config.server-config.monitoring-service.module-monitoring-levels.web-services-container=HIGH]
}
----

The auditing service will relay these events to the xref:/Technical Documentation/Payara Server Documentation/Logging and Monitoring/Notification Service/Overview.adoc[Notification Service]. In this manner, administrators can be alerted of suspicious activity as soon as possible.

This service can be configured from the admin console and from the command line.

[[from-the-admin-console]]
=== From the Admin Console

The auditing service configuration can be found in the web console under `Configurations` -> `<configuration-name>` -> `Security` -> `Admin Audit`:

image:admin-console/admin-audit-menu.png[Admin Audit Service in Web Console]

Once enabled, actions in the admin console that have a corresponding `asadmin` command will be sent to the xref:/Technical Documentation/Payara Server Documentation/Logging and Monitoring/Notification Service/Overview.adoc[Notification service].

Check the *Enabled* option (and the *Dynamic* option too if you don't want to
restart the domain) to switch the auditing service on.

The *Audit Level* options sets the level of operations that will be logged:

**MODIFIERS**:: (Default setting) All operations that modify the configuration of the server in some capacity.
**ACCESSORS**:: All operations query the configuration of the server in some capacity.
**INTERNAL**:: All existing operations, including internal operations of the server.

Aside from this configuration setting, you can also define which notifiers will be used to relay the admin console audit events by moving them to the **Selected Notifiers** box.

image:request-tracing/select-notifiers.png[Activate Notifiers in the Admin Console]

IMPORTANT: Keep in mind that for audit events to be relayed to the
selected notifiers, both the Notification Service and each selected notifier must be enabled and configured beforehand.

TIP: You don't need to manually add each notifier on this screen. When enabling
a notifier on its configuration screen, the server will **automatically** add it to the list of selected notifiers for the Admin audit service. This same result occurs when enabling the notifier using the appropriate _asadmin_ command.

[[from-the-commandline]]
=== From the Command Line

The following is the list of available asadmin commands with their available
options to configure the auditing service:

[[set-admin-audit-configuration]]
==== `set-admin-audit-configuration`

*Usage*::
`asadmin> set-admin-audit-configuration`

*Aim*::
This command can be used to set the configuration settings of the service.

[[command-options]]
===== Command Options

[cols=",,a,,",options="header",]
|=======================================================================
|Option      |Type    |Description                     |Default |Mandatory
|`--enabled` |Boolean |Enables or disables the service |false   |No
|`--dynamic` |Boolean |Whether to apply changes immediately of after a domain restart. |false |No
|`--auditLevel` |String | Sets the auditing level. One of:

* MODIFIERS
* ACCESSORS
* INTERNAL
| MODIFIERS | No
|=======================================================================

[[example]]
===== Example

[source, shell]
----
asadmin> set-admin-audit-configuration --enabled=true --dynamic=true --auditLevel=ACCESSORS

Command set-admin-audit-configuration executed successfully.
----


[[set-admin-audit-service-notifier-configuration]]
==== `set-admin-audit-service-notifier-configuration`

*Usage*::

----
asadmin> set-admin-audit-service-notifier-configuration
 --notifier=<string>
 --enabled=true|false
 --dynamic=true|false
 --noisy=true|false
----

*Aim*::
This command can be used to enable or disable a specific notifier and the verbosity of the events being relayed.

[[command-options-1]]
===== Command Options

[cols=",,a,,",options="header",]
|===
|Option
|Type
|Description
|Default
|Mandatory

| `--notifier`
| String
| The notifier to configure. One of (case-insensitive):

* `LOG`
* `HIPCHAT`
* `SLACK`
* `JMS`
* `EMAIL`
* `XMPP`
* `SNMP`
* `EVENTBUS`
* `NEWRELIC`
* `DATADOG`
* `CDIEVENTBUS`

| -
| yes

|`--enable`
|Boolean
|Enables or disables the notifier
|false
|Yes

|`--noisy`
|Boolean
|Enables or disables *noisy mode*. A noisy notifier includes verbose information in the notifiers output.
|-
|No

|`--dynamic`
|Boolean
|Whether to apply the changes immediately or after server restart
|false
|No

| `--target`
|String
|The instance or cluster that will be configured
|server
|no

|===

[[example-1]]
===== Examples

To configure the auditing service to relay events to the log notifier without having to restart the domain run the following command:

[source, shell]
----
asadmin> set-admin-audit-service-notifier-configuration --notifier=log --enabled=true --dynamic=true --noisy=false
log.enabled was false set to true
log.noisy was true set to false

Command set-admin-audit-service-notifier-configuration executed successfully.
----

[[get-admin-audit-configuration]]
==== `get-admin-audit-configuration`

*Usage*::
`asadmin> get-admin-audit-configuration`

*Aim*::
This command can be used to list the configuration settings of the auditing service.

[[command-options-2]]
===== Command Options

There are no available options for this command.

[[example-2]]
===== Example

Running the following command will yield the current configuration of the auditing service:

[source, shell]
----
asadmin> get-admin-audit-configuration

Enabled  Audit Level
false    MODIFIERS
Name     Notifier Enabled
LOG      false

Command get-admin-audit-configuration executed successfully.
----

NOTE: The first row corresponds to the service configuration, second row onwards will detail any notifiers being configured..

[[admin-console-environment-warning]]
== Admin Console Environment Warning

When working with multiple shared environments, it is common for restrictions to be in place on what modifications can be allowed for a given domain. For example, the test environment cannot deviate significantly from the target production environment without potentially invalidating the test.

One way to ensure no accidental changes are made would be to revoke access to the admin console, but this has the downside of preventing engineers from seeing the current settings in the event that a bug is found.

As an alternative, Payara Server ships with a configurable warning bar to ensure any user will see a warning message in while viewing the console:

image:admin-console/environment-warning.png[alt="Payara Server 172 Environment Warning screenshot"]

The warning can be configured in the admin console as seen in the screenshot above. There is a new "_Environment Warning_" tab in the "_Domain_" section which allows you to configure the text and colours of the warning message.

[[configuring-the-environment-warning-via-asadmin]]
== Configuring the Environment Warning via Asadmin

There are corresponding asadmin commands to get and set the configuration

[[set-environment-warning-configuration]]
=== `set-environment-warning-configuration`

*Usage:* `asadmin> set-environment-warning-configuration --enabled=true --message="Caution, this is on production" --textcolour="#00ff00" --backgroundcolour="#ff00ff"`

*Aim:* Sets the environment warning properties and can enable/disable the warning

[[get-environment-warning-configuration]]
=== `get-environment-warning-configuration`

*Usage:* `asadmin> get-environment-warning-configuration`

*Aim:* Gets the current environment warning configuration

*Example:*::
[source]
----
Enabled  Message                         Background Colour  Text Colour
true     Caution, this is on production  #ff00ff            #00ff00
Command get-environment-warning-configuration executed successfully.
----

[[command-options]]
=== Command Options

[cols="4,2,5,1,1",options="header"]
|====
|Option
|Type
|Description
|Default
|Mandatory

|`enabled`
|boolean
|If it is set to true, the top warning banner is shown, otherwise it is not.
|-
|Yes

|`message`
|String
|Text message for the top warning banner.
|-
|Yes

|`backgroundcolour`
|Hex colour code
|Background colour for the top warning banner. It must be a hex value, like `#ffffff`.
|-
|Yes

|`textcolour`
|Hex colour code
|Text colour for the top warning banner. It must be a hex value, like `#ffffff`.
|-
|Yes

|====
